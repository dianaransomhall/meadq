{
    "contents" : "# make-table-by-chem.R\n# Diana Hall\n# 8-13-2014\n# purpose: to make a table by Div\n\n\nlibrary(meadq)\nEPA=1\ndrive.letter<-\"E\"\nif(EPA){\n  data.dir<-\"L:/Lab/NHEERL_MEA/PIP3 - Project/Data/Specific Aim 1/prepared_data/\"\n  output.path<-\n    \"L:/Lab/NHEERL_MEA/PIP3 - Project/Analysis/DIVtable/table-by-DIV-8-18-2014.csv\"\n  \n} else{\n  data.dir<-paste(drive.letter,\":/Kathleen/Data/prepared_data/\",sep=\"\")\n  output.path<-paste(drive.letter,\n                     \":/Kathleen/Analysis/DIVtable/table-by-DIV-8-18-2014.csv\",\n                     sep=\"\")\n}\n\ndata<-paste(data.dir,\"AllAEOntogeny_files.csv\",sep=\"\")\n\n\ntemp.df<-read.table(data,sep=\",\",header=T)\ndf.allDIV<-temp.df[temp.df$DIV!=12.1, ]\ndf.allDIV<-df.allDIV[!grepl(df.allDIV$trt,pattern=\"BIC\"), ]\n                          \nchem.dose<-paste( df.allDIV$trt, df.allDIV$dose,sep=\"_\"  )\nindex.c<-which(df.allDIV$dose==0)\nchem.dose[index.c]<-\"cont\"\ndf.allDIV$chem.dose<-chem.dose\n\n\nendpoints.wanted<-setdiff(\n  names(df.allDIV)[which(is.element(sapply( df.allDIV, class), \n                         c(\"numeric\",\"integer\")))],\n  c(\"date\",\"DIV\",\"dose\") )\n\n#make laymens names for endpoints\ntemp.ep<-endpoints.wanted\ntemp.ep[which(temp.ep==\"mean.isis\")]<-\"Inter Spike Interval\"\ntemp.ep[which(temp.ep==\"per.spikes.in.burst\")]<-\n  \"% Spikes in Bursts\"\ntemp.ep[which(temp.ep==\"nABE\")]<-\n  \"# Actively Bursting Electrodes\"\ntemp.ep[which(temp.ep==\"nAE\")]<-\n  \"# Active Electrodes\"\ntemp.ep[which(temp.ep==\"r\")]<-\n  \"Correlation Coefficient (r)\"\ntemp.ep[which(temp.ep==\"cv.network\")]<-\n  \"CV Network (Keefer, 2013)\"\ntemp.ep[which(temp.ep==\"cv.time\")]<-\n  \"CV Time (Keefer, 2013)\"\ntemp.ep[which(temp.ep==\"ns.peak.m\")]<-\n  \"# Spikes at Peak Network Spike (Marom, 2006)\"\ntemp.ep[which(temp.ep==\"ns.mean.spikes.in.ns\")]<-\n  \"# Spikes in Network Spike (Marom, 2006)\"\ntemp.ep[which(temp.ep==\"mean.IBIs\")]<-\n  \"Inter Burst Interval\"\ntemp.ep[which(temp.ep==\"ns.n\")]<-\n  \"# Network Spikes (Marom, 2006)\"\ntemp.ep[which(temp.ep==\"ns.durn.m\")]<-\n  \"Network Spike Duration (s) (Marom, 2006)\"\ntemp.ep[which(temp.ep==\"ns.mean.spikes.in.ns\")]<-\n  \"# Spikes in Network Spikes (Marom, 2006)\"\ntemp.ep[which(temp.ep==\"mean.dur\")]<-\n  \"Burst Duration (s)\"\ntemp.ep[which(temp.ep==\"ns.durn.sd\")]<-\n  \"sd of Network Spike duration (s)\"\ntemp.ep[which(temp.ep==\"ns.mean.insis\")]<-\n  \"ISI of Spikes in Network Spikes (s)\"\ntemp.ep[which(temp.ep==\"ns.percent.of.spikes.in.ns\")]<-\n  \"% Spikes in Network Spikes (Marom, 2006)\"\n\n\n\n\n\n\nDIV.all<-unique(df.allDIV$DIV)\n#DIV.wanted=5\ndf.combo.list=list()\nfor (cur.ep in endpoints.wanted){\n  \n  name.cur.ep<-temp.ep[cur.ep==endpoints.wanted]\n  \n  for (DIV.wanted in DIV.all){\n    \n    df<-df.allDIV[ df.allDIV$DIV==DIV.wanted,  ]\n    \n    df.mean<-aggregate( df, by=list(df$chem.dose), FUN=mean, na.rm=T)\n    df.sd<-aggregate( df, by=list(df$chem.dose), FUN=sd, na.rm=T)\n    df.n<-aggregate( df, by=list(df$chem.dose), FUN=length)\n    df.se<-cbind(chem.dose.group=df.sd[,1], \n                 df.sd[,2:length(df.sd[1,])]/df.n[,2] )\n    \n    names(df.se)<-paste(names(df.mean),\"se\",sep=\".\")\n    \n    df.combo<-cbind( df.mean[ ,c(9:26)], df.se[ ,c(9:26)] )\n    order.combo.names<-sort(names(df.combo))\n    df.combo<-df.combo[ ,order.combo.names]\n    df.combo.temp<-cbind(chem.dose=df.mean[,1], n=df.n[,2], df.combo)\n    \n    df.combo.list[[paste(DIV.wanted)]]<-df.combo.temp\n  } \n  \n  count=1\n  temp.data<-lapply(df.combo.list, function(x) \n     x[ ,c(\"chem.dose\",\"n\",ep.wanted, paste(ep.wanted,\".se\",sep=\"\"))] \n   )\n  \n  temp.data.length<-unlist(lapply(temp.data, function(x) length(x[,1]) ) )\n  \n  DIV.fornames<- match(max(temp.data.length), temp.data.length)[1]\n  chem.dose.wanted<-temp.data[[DIV.fornames]]$chem.dose\n  \n  temp.matrix<-matrix(0, nrow=length(chem.dose.wanted),\n                      ncol=3*length(temp.data) )\n  rownames(temp.matrix)<-chem.dose.wanted; names.temp<-c()\n  for (i in 1:length(temp.data) ){\n    cur.rows<-which(is.element(chem.dose.wanted,temp.data[[i]]$chem.dose))\n    temp.matrix[cur.rows, (i-1)*3+1 ]<- temp.data[[i]][ , \"n\"]\n    temp.matrix[cur.rows, (i-1)*3+2 ]<- temp.data[[i]][ , ep.wanted]\n    temp.matrix[cur.rows, (i-1)*3+3 ]<- temp.data[[i]][ ,\n                                    paste(ep.wanted,\".se\",sep=\"\")]\n             \n    names.temp<-c(names.temp,\n                  paste(c(\"n\",ep.wanted,paste(ep.wanted,\".se\",sep=\"\")),\n                        DIV.all[i],sep=\".\") )\n  }\n  temp<-strsplit(as.character(chem.dose.wanted),split=\"_\")\n  chem<-unlist(lapply(temp, function(x) x[1] ) )\n  dose<-unlist(lapply(temp, function(x) x[2] ) )\n                            \n              \n  df.by.div<-data.frame(chem, dose, temp.matrix)\n  colnames(df.by.div)<-c(\"chem\",\"dose\", names.temp)\n  \n  ##### output \n  \n  write.table(file=output.path, \" \", sep=\",\", append=T,\n              col.names=F, row.names=F)\n  write.table(file=output.path, \" \", sep=\",\", append=T )\n  write.table(file=output.path, name.cur.ep, sep=\",\", append=T )\n  write.table(file=output.path, df.by.div,  sep=\",\", append=T,\n              row.names=F)\n  \n}\n  \n\n\n\n\n",
    "created" : 1407966526844.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "87|30|105|2|\n",
    "hash" : "979019323",
    "id" : "9CEAC3A0",
    "lastKnownWriteTime" : 1408399264,
    "path" : "E:/Kathleen/Analysis/DIVtable/make-table-by-chem.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}